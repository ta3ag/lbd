

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>About &mdash; Write An LLVM Backend Tutorial For Cpu0</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="#" />
    <link rel="top" title="Write An LLVM Backend Tutorial For Cpu0" href="index.html" />
    <link rel="next" title="Cpu0 Instruction and LLVM Target Description" href="llvmstructure.html" />
    <link rel="prev" title="Table of Contents" href="index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Write An LLVM Backend Tutorial For Cpu0</span></a></h1>
        <h2 class="heading"><span>About</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="index.html">Table of Contents</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="llvmstructure.html">Cpu0 Instruction and LLVM Target Description</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="about">
<h1>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h1>
<div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<div class="figure align-right">
<img alt="_images/Author_ChineseName.png" src="_images/Author_ChineseName.png" />
</div>
<dl class="docutils">
<dt>Chen Chung-Shu</dt>
<dd><p class="first"><a class="reference external" href="mailto:gamma_chen&#37;&#52;&#48;yahoo&#46;com&#46;tw">gamma_chen<span>&#64;</span>yahoo<span>&#46;</span>com<span>&#46;</span>tw</a></p>
<p class="last"><a class="reference external" href="http://jonathan2251.github.com/web/index.html">http://jonathan2251.github.com/web/index.html</a></p>
</dd>
<dt>Anoushe Jamshidi</dt>
<dd><a class="reference external" href="mailto:ajamshidi&#37;&#52;&#48;gmail&#46;com">ajamshidi<span>&#64;</span>gmail<span>&#46;</span>com</a></dd>
</dl>
</div>
<div class="section" id="revision-history">
<h2>Revision history<a class="headerlink" href="#revision-history" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Version 3.2.2, Released January 10, 2013</dt>
<dd>Add section &#8220;Full support %&#8221; and section &#8220;Verify DIV for operator %&#8221;.</dd>
<dt>Version 3.2.1, Released January 7, 2013</dt>
<dd>Add Footnote for references.
Reorganize chapters (Move bottom part of chapter &#8220;Global variable&#8221; to
chapter &#8220;Other instruction&#8221;; Move section &#8220;Translate into obj file&#8221; to
new chapter &#8220;Generate obj file&#8221;.
Fix errors in Fig/otherinst/2.png and Fig/otherinst/3.png.</dd>
<dt>Version 3.2.0, Released January 1, 2013</dt>
<dd>Add chapter Function.
Move Chapter &#8220;Installing LLVM and the Cpu0 example code&#8221; from beginning to
Appendix A.
Add subsection &#8220;Install other tools on Linux&#8221;.
Add chapter ELF.</dd>
<dt>Version 3.1.2, Released December 15, 2012</dt>
<dd>Fix section 6.1 error by add “def : Pat&lt;(brcond RC:$cond, bb:$dst),
(JNEOp (CMPOp RC:$cond, ZEROReg), bb:$dst)&gt;;” in last pattern.
Modify section 5.5
Fix bug Cpu0InstrInfo.cpp SW to ST.
Correct LW to LD; LB to LDB; SB to STB.</dd>
<dt>Version 3.1.1, Released November 28, 2012</dt>
<dd>Add Revision history.
Correct ldi instruction error (replace ldi instruction with addiu from the
beginning and in the all example code).
Move ldi instruction change from section of &#8220;Adjust cpu0 instruction and
support type of local variable pointer&#8221; to Section ”CPU0
processor architecture”.
Correct some English &amp; typing errors.</dd>
</dl>
</div>
<div class="section" id="licensing">
<h2>Licensing<a class="headerlink" href="#licensing" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add info about LLVM documentation licensing.</p>
</div>
</div>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<p>The LLVM Compiler Infrastructure provides a versatile structure for creating new
backends. Creating a new backend should not be too difficult once you
familiarize yourself with this structure. However, the available backend
documentation is fairly high level and leaves out many details. This tutorial
will provide step-by-step instructions to write a new backend for a new target
architecture from scratch.</p>
<p>We will use the Cpu0 architecture as an example to build our new backend. Cpu0
is a simple RISC architecture that has been designed for educational purposes.
More information about Cpu0, including its instruction set, is available
<a class="reference external" href="http://ccckmit.wikidot.com/ocs:cpu0">here</a>. The Cpu0 example code referenced in
this book can be found <a class="reference external" href="http://jonathan2251.github.com/lbd/LLVMBackendTutorialExampleCode.tar.gz">here</a>.
As you progress from one chapter to the next, you will incrementally build the
backend&#8217;s functionality.</p>
<p>This tutorial was written using the LLVM 3.1 Mips backend as a reference. Since
Cpu0 is an educational architecture, it is missing some key pieces of
documentation needed when developing a compiler, such as an Application Binary
Interface (ABI). We implement our backend borrowing information from the Mips
ABI as a guide. You may want to familiarize yourself with the relevant parts of
the Mips ABI as you progress through this tutorial.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Readers should be comfortable with the C++ language and Object-Oriented
Programming concepts. LLVM has been developed and implemented in C++, and it is
written in a modular way so that various classes can be adapted and reused as
often as possible.</p>
<p>Already having conceptual knowledge of how compilers work is a plus, and if you
already have implemented compilers in the past you will likely have no trouble
following this tutorial. As this tutorial will build up an LLVM backend
step-by-step, we will introduce important concepts as necessary.</p>
<p>This tutorial references the following materials.  We highly recommend you read
these documents to get a deeper understanding of what the tutorial is teaching:</p>
<p><a class="reference external" href="http://www.aosabook.org/en/llvm.html">The Architecture of Open Source Applications Chapter on LLVM</a></p>
<p><a class="reference external" href="http://llvm.org/docs/CodeGenerator.html">LLVM&#8217;s Target-Independent Code Generation documentation</a></p>
<p><a class="reference external" href="http://llvm.org/docs/TableGenFundamentals.html">LLVM&#8217;s TableGen Fundamentals documentation</a></p>
<p><a class="reference external" href="http://llvm.org/docs/WritingAnLLVMBackend.html">LLVM&#8217;s Writing an LLVM Compiler Backend documentation</a></p>
<p><a class="reference external" href="http://www.opus.ub.uni-erlangen.de/opus/volltexte/2010/1659/pdf/tricore_llvm.pdf">Description of the Tricore LLVM Backend</a></p>
<p><a class="reference external" href="http://www.linux-mips.org/pub/linux/mips/doc/ABI/mipsabi.pdf">Mips ABI document</a></p>
</div>
<div class="section" id="outline-of-chapters">
<h2>Outline of chapters<a class="headerlink" href="#outline-of-chapters" title="Permalink to this headline">¶</a></h2>
<p>Chapter of Cpu0 Instruction and LLVM Target Description:</p>
<p>Introduce Cpu0 and LLVM architecture, Target Description td, cmake and
LLVMBuild files, Target Registration. And shows how to start a backend and
build it through our example code Cpu0.
Around 750 lines of source code are added by the end of this chapter.</p>
<p>Chapter of Back end Structure:</p>
<p>Introduce the backend structure by UML graph, and continue to add code in each
section.
Around 2300 lines of source code added in this chapter.
These 2300 lines of source code is common in backend design.
Many code are same from backend to backend except the backend name.
At end of this chapter, an LLVM backend structure for cpu0 is created with
three instructions support to generate the assembly output file.</p>
<p>Chapter of Other instructions:</p>
<p>Over ten of C operators and their corresponding LLVM IR instructions
introduced in this chapter. Around 345 lines of source code (most are in
.td Target Description file) are added. With these 345 lines, it can translate
<strong>+, -, *, /, &amp;, |, ^, &lt;&lt;, &gt;&gt;, !</strong> and <strong>%</strong> into assembly code.
The <tt class="docutils literal"><span class="pre">llc</span></tt> debug option and debug tool <strong>Graphviz</strong> which supported by LLVM
introduced in this chapter.</p>
<p>Chapter of Generate obj file:</p>
<p>Add the obj file format generated support in cpu0 backend, and introduce the
cpu0 backend Target Registration structure.
The Registration structure is common in backend design.
With these 700 lines of code added, cpu0 can handle big and little endian
obj file generated.</p>
<p>Chapter of Global variable, struct and array:</p>
<p>Global variable, struct and array support added in this chapter.
Over 300 lines of source code needed in global variable access while 345 lines
needed for ten of operators in chapter of Other instructions.
The cpu0 support PIC and static addressing mode. These two modes are explained
in this chapter.</p>
<p>Chapter of Control flow statement:</p>
<p>The <strong>if, else, while, for, goto</strong> flow control statements support is
added in this chapter.
Around 150 lines of source code added in this chapter.</p>
<p>Chapter of Function call:</p>
<p>The stack frame, incoming &amp; outgoing arguments, and LLVM corresponding handle
functions introduced in this chapter.
Over 700 lines of source code added in this chapter.</p>
<p>Chapter of ELF:</p>
<p>Like many backend. Cpu0 support ELF obj format generated. The ELF format and
binutils tools (not a part of LLVM) introduced and demonstrate the backend
designers how to use this ELF tool to verify and analysis the backend obj.</p>
<p>Chapter of Appendix A:</p>
<p>Include the LLVM source code, development tools installation, and environment
setting on iMac and Linux platform.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="index.html">Table of Contents</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="llvmstructure.html">Cpu0 Instruction and LLVM Target Description</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, LLVM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>